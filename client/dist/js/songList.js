"use strict";function _objectWithoutProperties(t,a){var e={};for(var i in t)0<=a.indexOf(i)||Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}$(function(){var l=window.parent.commonObj,i=window.parent.audioPlayer,t={setLocal:function(){var t=$.$store.get("songList"),a=$.$store.get("coverDetail");if(null==t||null==a)return null;$(".song-list").render($(layoutTemp).find("#gridListTemp"),t);var e=template("coverTemp",a);return $(".song-detail-list .cover").html(e),t&&a},init:function(){null==this.setLocal()&&this.getPlayList(),this.onShow()},getPlayList:function(){$.ajax({type:"get",dataType:"json",data:{id:$.$route.query.id},url:apiUrls.song.playlist,success:function(s){var a;200==s.code&&(a=[],s.playlist.trackIds.forEach(function(t){a.push(t.id)}),a=a.join(","),t.getSongDetail({ids:a},function(t){s.playlist.tracks=t.songs,s.privileges=t.privileges,s.playlist.tracks.map(function(t){t.dt=$.filterDruationTime(t.dt)});var a=s.playlist,e=(a.subscribers,a.trackIds,a.tracks,_objectWithoutProperties(a,["subscribers","trackIds","tracks"]));e.createTime=new Date(e.createTime).toLocaleDateString().split("/").join("-"),e.playCount=$.filterPlayCount(e.playCount),e.subscribedCount=$.filterPlayCount(e.subscribedCount),e.shareCount=$.filterPlayCount(e.shareCount);var i=template("coverTemp",{coverDetail:e});$(".song-detail-list .cover").html(i),l.data.tracks=s.playlist.tracks,$(".song-list").render($(layoutTemp).find("#listTemp"),{list:s.playlist.tracks,order:!0,operation:!0}),e.description&&null!==e.description&&$(".song-detail-list .desc p").html("简介："+e.description.split("\n").join("<br/>")),$.$store.set("songList",{list:s.playlist.tracks,order:!0,operation:!0},(new Date).getTime()+2e3),$.$store.set("coverDetail",{coverDetail:e},(new Date).getTime()+2e3)}))}})},getSongDetail:function(t,a){$.ajax({type:"get",dataType:"json",data:t,url:apiUrls.song.detail,success:function(t){t.result;a(t)}})},onShow:function(){$(".song-detail-list").on("click",".js-more",function(){$(this).toggleClass("active").parent().toggleClass("active line-two")}),$(".song-detail-list").on("click",".music-list-item",function(){$(this).addClass("active").siblings().removeClass("active")}),$(".song-detail-list").on("dblclick",".music-list-item",function(){var a=$(this);$(this).attr("data-id")==l.playData.id&&!l.playData.ended||(l.data.tracks.forEach(function(e,t){e.id==a.attr("data-id")&&(i.muted=!1,l.playData.id=e.id,l.playData.name=e.name,l.playData.singer="",e.ar.forEach(function(t,a){l.playData.singer+=t.name+(a<e.ar.length-1?"/":"")}),l.playData.picUrl=e.al.picUrl)}),l.getData.getPlayUrl({id:l.playData.id},function(t){i.src=t.url,i.volume=l.playData.volume,l.playData.src=t.url,l.setCurrentData(l.playData),$.$store.set("playList",l.data),l.getData.getPlayList(l.data),a.removeClass("pause").addClass("play active").siblings().removeClass("play active pause"),$(window.parent.document).find(".js-mini-music-list, .js-footer-music-list").find(".music-list-item").each(function(t,a){$(a).attr("data-id")==l.playData.id&&$(a).removeClass("pause").addClass("play active").siblings().removeClass("play active pause")}),$(window.parent.document).find(".js-play").addClass("play"),i.play()}))})}};t.init()});