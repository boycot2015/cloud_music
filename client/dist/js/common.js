"use strict";var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t};window.myiframe=$("#iframe-pages");var commonObj={weeks:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],timer:null,progressPsition:"",maxPlayWidth:372,audioPlayer:$("#play-audio")[0],audioTimePos:{l:-4,t:-6,r:372,b:-4},audioVolumePos:{l:-4,t:-6,r:82,b:-4},maxVolumeWidth:82,playData:{src:"",name:"至尊宝",singer:"徐良/杨威",coverImg:"/dist/images/avatar.jpg",volume:.1,loop:!1,ended:!1,muted:!1,currentTime:0,duration:0},data:{tracks:[],code:200},TemplateEngine:function(t,e){for(var a=/<%([^%>]+)?%>/g,n=/(^( )?(if|for|else|switch|case|break|{|}))(.*)?/g,o="var r=[];\n",i=0,r=function t(e,a){return o+=a?e.match(n)?e+"\n":"r.push("+e+");\n":""!=e?'r.push("'+e.replace(/"/g,'\\"')+'");\n':"",t};match=a.exec(t);)r(t.slice(i,match.index))(match[1],!0),i=match.index+match[0].length;return r(t.substr(i,t.length-i)),o+='return r.join("");',new Function(o.replace(/[\r\t\n]/g,"")).apply(e)},getTpl:function(t){return $.ajax({type:"GET",url:t,async:!1}).responseText},getAudioInfo:function(t,e){var a=t.duration||0,n=parseInt(a/60),o=parseInt(a%60),i=t.currentTime,r=60*n+o,s=(n=n<10?"0"+n:n)+":"+(o=o<10?"0"+o:o),l=(n=59<Math.round(i)?Math.round(i/60)<10?"0"+parseInt(i/60):Math.round(i/60):"00")+":"+(o=60==(o=parseInt(i%60)<10?"0"+parseInt(i%60):parseInt(i%60))?"00":o);this.playData.src=t.src,this.playData.ended=t.ended,this.playData.muted=t.muted,this.playData.curStr=l,this.playData.endStr=s,this.playData.duration=r,this.playData.currentTime=parseInt(i),e&&e(parseInt(i),l,s,r)},initPlayer:function(t,e){t.addEventListener("timeupdate",function(){commonObj.getAudioInfo(t,e)}),t.addEventListener("loadedmetadata",function(){commonObj.getAudioInfo(t,e)}),t.addEventListener("ended",function(){commonObj.getAudioInfo(t,e),clearInterval(commonObj.timer)})},setStatus:function(t,e,a,n){var o=0;n=n||1,commonObj.progressPsition&&(o=commonObj.progressPsition.left),o=t*$(".progress .progress-bar").width()/n,o=Math.abs(o),audioPlayer.loop&&!t&&($(".js-play").removeClass("play"),setTimeout(function(){$(".js-play").addClass("play")},1e3)),commonObj.playData.ended&&(audioPlayer.pause(),$(".js-play").removeClass("play"),commonObj.playData.loop&&(audioPlayer.play(),$(".js-play").addClass("play"),audioPlayer.loop=!0)),o=o>commonObj.maxPlayWidth?commonObj.maxPlayWidth:o,t<=0&&$(".progress .end-time").html(a),$(".progress .progress-bar .point").css("left",o),$(".progress .progress-bar .js-line").css("width",o),$(".progress .start-time").html(e)},setCurrentData:function(n,o){var e=n&&n.attr("data-id")||"";n||null===$.$store.get("playData")||(e=$.$store.get("playData").id),commonObj.data.tracks.length||null===$.$store.get("playList")||(commonObj.data.tracks=$.$store.get("playList").tracks),null!==$.$store.get("playData")&&(commonObj.playData=$.$store.get("playData")),e&&(commonObj.data.tracks.forEach(function(a,t){a.id==e&&(commonObj.playData.id=a.id,commonObj.playData.name=a.name,commonObj.playData.alName=a.al.name,commonObj.playData.singer="",a.ar.forEach(function(t,e){commonObj.playData.singer+=t.name+(e<a.ar.length-1?"/":"")}),commonObj.playData.picUrl=a.al.picUrl)}),commonObj.getData.getPlayUrl({id:e},function(t){var e,a;audioPlayer=audioPlayer||$(parent.document).find("#play-audio")[0],audioPlayer.src!==t.url&&(audioPlayer&&(audioPlayer.muted=!1,audioPlayer.src=t.url,audioPlayer.volume=commonObj.playData.volume),commonObj.playData.src=t.url,commonObj.playData.level=t.level,commonObj.playData.type=t.type,$.$store.set("playData",commonObj.playData),$.$store.set("playList",commonObj.data),commonObj.getData.getPlayList(commonObj.data),e=commonObj.playData,(a=$(".music-client")[0]?$(".music-client"):$(parent.document)).find(".js-mini-music-box img").attr("src",e.picUrl),a.find(".js-music-box .music-info").attr("data-id",e.id),a.find(".js-music-box .music-info").find("img").attr("src",e.picUrl),a.find(".js-music-box .music-info .name").html(e.name).parent().siblings().find(".singer").html(e.singer),a.find(".js-mini-music-box").find(".left .more .name").html(e.name).siblings(".singer").html(e.singer),$(window.parent.document).find(".js-mini-music-list, .js-footer-music-list").find(".music-list-item").each(function(t,e){$(e).attr("data-id")==commonObj.playData.id&&$(e).removeClass("pause").addClass("play active").siblings().removeClass("play active pause")}),o&&o(),n&&(n.removeClass("pause").addClass("play active").siblings().removeClass("play active pause"),window.iframePages&&iframePages.window.detailObj&&iframePages.window.detailObj.mounted(),a.find(".js-aside .music-info").show(),a.find(".js-play").removeClass("pause").addClass("play"),audioPlayer.muted=!1,audioPlayer.src=t.url,audioPlayer.volume=commonObj.playData.volume,audioPlayer.loop=!1,audioPlayer.play()))}))},palyMusic:function(t,e){var a=t.attr("data-id"),n=t.attr("data-type"),o=t.attr("data-ctype"),i=t.attr("data-url");$.$route.query={id:a,type:n,ctype:o,url:i},i?(commonObj.playData=_extends({},commonObj.playData,{id:a,type:n,ctype:o,name:t.find(".name").text(),singer:t.find(".singer").text(),picUrl:t.find("img").attr("src")}),$.$store.set("playData",commonObj.playData),commonObj.setCurrentData(t,e)):$.$router.push("/songs/list",{id:a,type:n,ctype:o})},getData:{init:function(){this.getMenu(),commonObj.setCurrentData(),this.getPlayList(commonObj.data),commonObj.onload()},getMenu:function(){$.ajax({type:"get",dataType:"json",data:{json:1},url:"/json/menu.json",success:function(t){var e=$(layoutTemp).find("#asideTemp").text(),a=template.render(e,{list:t});$(".js-aside-template").html(a)}})},getPlayList:function(t){var e=$.$store.get("playList");null!=e&&(t=e);var a=$(layoutTemp).find("#listTemp");$(".js-footer-music-list").render(a,{list:t.tracks,page:t.size,isPlay:!0}),$(".js-mini-music-list ul").render(a,{list:t.tracks,isminiPlay:!0}),$(".js-music-box .total .num i").html(t.tracks.length)},getPlayUrl:function(n,o){$.ajax({type:"get",dataType:"json",data:n,url:apiUrls.song.playUrl,success:function(t){var e,a;200==t.code&&(200==t.data[0].code?o(t.data[0]):(e=dialog({title:"",cancel:!1,okValue:"",content:"该歌曲无法播放！"}).show(),a=$(".js-footer-music-list").find(".music-list-item.play").next().next(),setTimeout(function(){e.close().remove(),n.id!=a.attr("data-id")&&commonObj.setCurrentData(a)},1e3)))}})}},onload:function(){var t=$.$store.get("route"),n=$.$store.get("url");null!==t&&($.$route={path:$.$store.get("route").path,query:$.$store.get("route").query}),$(document).on("click",function(t){$(".js-play-list")[0]?$(".js-play-list")[0].contains(t.target)||t.target.contains($(".js-play-list-btn")[0])||($(".js-play-list").hide(),$(window.parent.document).find(".js-play-list").hide()):$(window.parent.document).find(".js-play-list").hide(),myiframe.attr("src")&&myiframe.attr("src").includes("/songs/detail")?$(".js-aside").addClass("active"):$(".js-aside").removeClass("active")}),$(".js-logo").click(function(){$(myiframeDom).find(".song-detail").removeClass("active").addClass("leave"),$.$router.push("/index")}),myiframe.attr("src")&&n&&(myiframe.attr("src")!==n&&null!==n&&myiframe.attr("src",n),n.includes("/songs/detail")&&$(".js-aside").addClass("active")),$(".js-aside-template .js-list-item").each(function(t,e){var a="/src/pages";(a+=$(this).attr("data-path")+".html")==n&&$(this).addClass("active").siblings().removeClass("active").parent().parent().siblings().find(".js-list-item").removeClass("active")}),null==$.$store.get("playData")&&$(".js-aside .music-info").hide()}};window.layoutTemp=commonObj.getTpl("/template/layout.html"),window.contentTemp=commonObj.getTpl("/template/index.html"),window.audioPlayer=$("#play-audio")[0],$.extend({commonObj:commonObj,filterPlayCount:function(t){return t=5e4<t?parseInt(t/1e4)+"万":t},filterDruationTime:function(t){var e=Math.floor(t/60/1e3),a=Math.round(t/1e3%60);return(e=e<10?"0"+e:e)+":"+(a=a<10?"0"+a:a)},$route:{},$router:{push:function(t,e){var a=$("#iframe-pages").length?$("#iframe-pages"):$(window.parent.document).find("#iframe-pages"),n="";if(e){for(var o in n="?",e)n+=o+"="+e[o]+"&";n=n.slice(0,n.length-1)}var i="/src/pages"+t+".html"+n;$.$store.set("route",{path:t,query:e}),$.$store.set("historyUrl",a.attr("src")),$.$store.set("url",i),a.attr("src",i),a.find("#iframe-pages").attr("src",i)},replace:function(){$("#iframe-pages")[0].contentWindow.location.replace(path)},go:function(t){var e=0<arguments.length&&void 0!==t?t:1;$("#iframe-pages")[0].contentWindow.history.go(e)},forward:function(){var t=$("#iframe-pages")[0].contentWindow;return t.history.forward(),t.history.length},back:function(){var t=$("#iframe-pages")[0].contentWindow;return t.history.back(),t.history.length}},$store:{state:{},getters:function(){return(void 0).state},get:function(t){var e=JSON.parse(localStorage.getItem(t));if(null!=e){if(!(null!=e.expirse&&e.expirse<(new Date).getTime()))return e.value;this.remove()}return null},set:function(t,e,a){var n={value:e,expirse:new Date(a).getTime()};localStorage.setItem(t,JSON.stringify(n))},remove:function(t){window.localStorage.removeItem(t)},action:{},mutations:{}},getAngle:function(t){var e=window.getComputedStyle(t,null),a=e.getPropertyValue("-webkit-transform")||e.getPropertyValue("-moz-transform")||e.getPropertyValue("-ms-transform")||e.getPropertyValue("-o-transform")||e.getPropertyValue("transform")||"FAIL";console.log("Matrix: "+a);var n=a.split("(")[1].split(")")[0].split(","),o=n[0],i=n[1],r=(n[2],n[3],Math.sqrt(o*o+i*i));console.log("Scale: "+r);var s=Math.round(Math.atan2(i,o)*(180/Math.PI));return console.log("Rotate: "+s+"deg"),s},getUrlandParam:function(t,e){var a={};t=(t=null==t?"/index.html":t).replace("/src/pages",""),a.path=t.slice(0,t.indexOf(".html")),(t=t.slice(t.indexOf(".html"))).indexOf("?")&&(t=t.slice(t.indexOf("?")));var n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),o=t.substr(1).match(n);return null!=o&&(a[e]=unescape(o[2])),a}}),$.fn.extend({drag:function(r){var s=this,l=r.target||s,m=r.site||{},c=r.fn,u=r.cancelElem,d=document.documentElement.clientWidth||document.body.clientWidth,p=document.documentElement.clientHeight||document.body.clientHeight,m=m||{},s=s[0],l=l[0],f=m.n||0,y=m.l||0,g=m.r||0==m.r?m.r:d-l.offsetWidth,h=m.t||0,j=m.b||0==m.b?m.b:p-l.offsetHeight;s.onmousedown=function(n){g=m.r||0==m.r?m.r:d-l.offsetWidth,j=m.b||0==m.b?m.b:p-l.offsetHeight;var t=n||event,o=t.clientX-l.offsetLeft,i=t.clientY-l.offsetTop;if(n.stopPropagation(),$(n.target).closest(u).length)return!0;function e(t){var e=t||event,a=e.clientX-o,n=e.clientY-i;t.stopPropagation(),a<=y+f&&(a=0),g-f<=a&&(a=g),n<=h+f&&(n=0),j-f<=n&&(n=j),c&&c({left:a,top:n}),$(s).find(".point").show(),$(".js-mini-music-box").find(".volume").hide(),l.style.left=a+"px",l.style.top=n+"px"}function a(){var t=n||event,e=t.clientX-o,a=t.clientY-i;s.setCapture&&s.releaseCapture(),r.end&&r.end({left:e,top:a}),this.onmousemove=null,this.onmouseup=null,this.onclick=null}return s.setCapture?(s.onmousemove=e,s.onmouseup=a,s.setCapture()):(document.onmousemove=e,document.onmouseup=a),this}},render:function(t,e,a){var n=t.text();a?(this.html(a),this.append(template.render(n,e))):this.html(template.render(n,e))}}),$(function(){commonObj.getData.init(),window.frames["iframe-pages"]&&(window.myiframeDom=window.frames["iframe-pages"].contentWindow.document)});